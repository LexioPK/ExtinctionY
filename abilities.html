<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abilities - Extinction Y</title>

<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Standardized header styles & script -->
<link rel="stylesheet" href="header.css">
<script src="header.js" defer></script>

<style>
    body {
        font-family: "Lexend", sans-serif;
        background: #f0f0f0;
        margin: 0;
        padding: 20px;
    }

    /* Sticky centered title */
    h1 {
        text-align: center;
        margin-top: 10px;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        border-radius: 12px;
        overflow: hidden;
    }

    th, td {
        text-align: left;
        padding: 10px 12px;
        border-bottom: 1px solid #ddd;
        font-size: 1em;
    }

    th {
        background: #f5f5f5;
        font-weight: 600;
    }
    
    /* Bold ability names */
    td:first-child {
        font-weight: 600;
    }

    tr:hover { background: #f0f0f0; }

    /* Make rows clickable */
    tbody tr {
        cursor: pointer;
    }

    /* Pokémon sprites container */
    .pokemon-sprites {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 5px;
    }

    .pokemon-sprites img {
        width: 40px;
        height: 40px;
        object-fit: contain;
    }
</style>
</head>
<body>

<h1>Ability List</h1>

<table id="abilities-table">
    <thead>
        <tr>
            <th>Ability Name</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <!-- Abilities will be populated here -->
    </tbody>
</table>

<script>
/**
 * Load and display abilities in a table format
 * Fetches data from both abilities.json (for descriptions) and pokedex.json (for counts)
 */
function loadAbilities() {
    // Fetch both data sources in parallel
    Promise.all([
        fetch("data/abilities.json").then(r => r.json()),
        fetch("data/pokedex.json").then(r => r.json())
    ])
    .then(([abilities, pokedex]) => {
        // Track which Pokémon have each ability
        const abilityPokemon = {};
        
        // Iterate through all Pokémon in the pokedex
        Object.entries(pokedex).forEach(([pokemonName, pokemon]) => {
            // Get all abilities for this Pokémon (Ability1, Ability2, AbilityH)
            const pokemonAbilities = [pokemon.Ability1, pokemon.Ability2, pokemon.AbilityH].filter(Boolean);
            // Remove duplicates in case a Pokémon has the same ability in multiple slots
            const uniqueAbilities = [...new Set(pokemonAbilities)];
            
            // Add this Pokémon to each ability's list
            uniqueAbilities.forEach(ability => {
                if (!abilityPokemon[ability]) abilityPokemon[ability] = [];
                abilityPokemon[ability].push(pokemonName);
            });
        });

        // Get the table body element
        const tbody = document.querySelector("#abilities-table tbody");
        
        // Convert abilities object to array and sort alphabetically by ability key
        const sortedAbilities = Object.entries(abilities).sort((a, b) => {
            // Use the "name" field for sorting if available, otherwise use the key
            const nameA = a[1].name || a[0];
            const nameB = b[1].name || b[0];
            return nameA.localeCompare(nameB);
        });

        // Create table rows for each ability
        sortedAbilities.forEach(([key, ability]) => {
            // Get the Pokémon list for this ability (default to empty array if not found)
            const pokemonList = abilityPokemon[ability.name] || [];
            const count = pokemonList.length;
            
            // Filter out abilities with 0 Pokémon, except for "Zen Mode" and "Forecast"
            if (count === 0 && ability.name !== "Zen Mode" && ability.name !== "Forecast") {
                return;
            }

            const tr = document.createElement("tr");

            // Optional: Add click handler to navigate to ability detail page
            // Uncomment the following lines when ability detail page is available
            // tr.onclick = () => 
            //     window.location.href = `abilitydescriptions.html?name=${encodeURIComponent(ability.name)}`;
            
            // Create table cells with ability data
            const cell1 = document.createElement("td");
            cell1.textContent = ability.name;
            
            const cell2 = document.createElement("td");
            cell2.textContent = ability.desc;
            
            tr.appendChild(cell1);
            tr.appendChild(cell2);
            
            tbody.appendChild(tr);
            
            // Add a row for Pokémon sprites underneath
            if (pokemonList.length > 0) {
                const spriteRow = document.createElement("tr");
                const spriteCell = document.createElement("td");
                spriteCell.colSpan = 2;
                
                const spritesContainer = document.createElement("div");
                spritesContainer.className = "pokemon-sprites";
                
                // Add images for each Pokémon
                pokemonList.forEach(pokemonName => {
                    const img = document.createElement("img");
                    // Convert Pokémon name to lowercase for sprite filename
                    const spriteName = pokemonName.toLowerCase().replace(/[^a-z0-9-]/g, '');
                    img.src = `pokemon_sprites/${spriteName}.png`;
                    img.alt = pokemonName;
                    img.title = pokemonName;
                    // Handle missing images gracefully
                    img.onerror = function() {
                        this.style.display = 'none';
                    };
                    spritesContainer.appendChild(img);
                });
                
                spriteCell.appendChild(spritesContainer);
                spriteRow.appendChild(spriteCell);
                tbody.appendChild(spriteRow);
            }
        });
    })
    .catch(err => console.error("Ability JSON Load Error:", err));
}

// Initialize the table when the page loads
loadAbilities();
</script>

</body>
</html>