<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trainers</title>

    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Standardized header styles & script -->
    <link rel="stylesheet" href="header.css">
    <script src="header.js" defer></script>

    <link rel="stylesheet" href="style.css">
    <style>
        :root{
            --poke-border: 2px;
            --trainer-border-color: #6f6f6f; /* darker trainer-row border */
            --pokemon-border-color: #555555;  /* darker border for each pokemon entry (changed) */
            --inner-padding-x: 10px;
            --inner-padding-y: 12px;
            --moves-separator-thick: 4px; /* thickness for separators (use same thickness everywhere) */
            --sep-color: #e6e6e6;
        }

        /* base layout */
        body {
            font-family: 'Lexend', sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
        }

        .sidebar {
            position: fixed;
            top: 65px;
            left: 0;
            width: 220px;
            height: calc(100vh - 65px);
            background: white;
            overflow-y: auto;
            box-shadow: 3px 0 8px rgba(0,0,0,0.07);
            padding: 15px;
        }

        .route-tab {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: #f2f2f2;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }

        .route-tab:hover {
            background: #e3e3e3;
        }

        .route-tab.active {
            background: #1976d2;
            color: white;
            font-weight: 600;
        }

        .trainer-section {
            padding: 20px;
            max-width: 1600px;
            margin-left: 240px;
            margin-top: 90px;
            width: calc(100% - 240px);
        }

        .area-title {
            font-size: 1.8rem;
            margin-top: 30px;
            font-weight: 700;
        }

        .sub-header {
            margin-top: 25px;
            font-size: 1.4rem;
            text-decoration: underline;
        }

        .trainer-card {
            background: white;
            padding: 12px;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .trainer-header {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .trainer-sub {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 12px;
        }

        /* darker border for trainer entry rows */
        .trainer-row {
            display: flex;
            align-items: stretch;
            gap: 0;
            border: var(--poke-border) solid var(--trainer-border-color);
            border-radius: 10px;
            overflow: hidden;
            background: transparent;
        }

        .trainer-row > div { box-sizing: border-box; }

        .trainer-row > div:first-child {
            width: 240px;
            min-width: 240px;
            max-width: 240px;
            padding: 12px;
            background: #ffffff;
            border-right: 1px solid #e6e6e6;
            border-top: 1px solid #e6e6e6;
            border-bottom: 1px solid #e6e6e6;
        }

        /*
          Each pokemon column has a full border. Inner content lives in .pokemon-inner.
          Separators between sections are implemented as pseudo-elements on the target
          elements and are sized so they connect to the outer borders of the pokemon column.
        */
        .trainer-row > .pokemon-col {
            width: 200px;
            min-width: 200px;
            max-width: 200px;
            padding: 0; /* inner wrapper controls padding */
            background: #fafafa;
            /* full, darker border around each pokemon column */
            border: var(--poke-border) solid var(--pokemon-border-color);
            box-sizing: border-box;
            background-clip: padding-box;
            position: relative;
        }

        /* slightly alternate backgrounds to improve readability */
        .trainer-row > .pokemon-col:nth-child(2n) { background: #fbfbfc; }
        .trainer-row > .pokemon-col:nth-child(2n+1) { background: #fafafa; }

        /* when adjacent columns appear, keep a thin visual divider by overlapping edges.
           use a slightly darker thin divider to match darker pokemon borders */
        .trainer-row > .pokemon-col + .pokemon-col {
            margin-left: -2px; /* collapse overlapping edges so the thin line appears consistently */
            border-left: 1px solid var(--pokemon-border-color);
        }

        .pokemon-inner {
            padding: var(--inner-padding-y) var(--inner-padding-x);
            position: relative; /* needed for pseudo-element drawing */
        }

        .poke-img {
            width: 96px;
            height: 96px;
            image-rendering: pixelated;
            display: block;
            margin: 10px auto;
        }

        /*
          Info boxes: remove margins so layout is deterministic.
          We'll draw separators via ::before pseudo-elements so they span from the left outer border
          to the right outer border of the pokemon-col.
        */
        .pokemon-inner .info-box {
            background: transparent;
            padding: 12px 0; /* vertical spacing inside each info block so top/bottom equal to separator */
            margin: 0;
            font-size: 0.95rem;
            text-align: left;
            font-weight: 700;
            color: #111;
            position: relative;
        }

        .pokemon-inner .types {
            text-align: center;
            margin: 0 0 0 0;
            position: relative;
            padding: 12px 0; /* match spacing of info-box so separators align evenly */
        }

        /*
          Draw thick separators using pseudo-elements so they reach the left/right outer borders.
          The left/right offsets include --inner-padding-x plus the border width so the line meets the border.
        */
        .pokemon-inner .types + .info-box::before,
        .pokemon-inner .info-box + .info-box::before,
        .pokemon-inner .move-list::before {
            content: "";
            position: absolute;
            left: calc(-1 * var(--inner-padding-x) - var(--poke-border));
            right: calc(-1 * var(--inner-padding-x) - var(--poke-border));
            height: var(--moves-separator-thick);
            background: var(--sep-color);
            top: 0; /* sits at top edge of the element */
            z-index: 2;
        }

        /* make separator between move header and the moves themselves pronounced as well */
        .move-list .move-header {
            font-weight: 700;
            padding-bottom: 8px;
            margin-bottom: 8px;
            border-bottom: var(--moves-separator-thick) solid var(--sep-color); /* thick under-header separator */
            position: relative;
            z-index: 2;
        }

        /* ensure move-list spacing and that the pseudo separator doesn't overlap header text */
        .move-list {
            margin: 8px 0 0 0;
            position: relative;
            padding-top: 8px;
        }

        .move-list .move-item {
            padding: 6px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.85rem;
            background: transparent;
        }

        .move-list .move-item:last-child { border-bottom: none; }

        .poke-name a { color: #000; text-decoration: none; }
        .poke-name { padding-bottom: 6px; display:block; }

        .type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            margin: 2px 4px;
        }

        /* Type colors */
        .type-normal  { background:#A8A77A; }
        .type-fire    { background:#EE8130; }
        .type-water   { background:#6390F0; }
        .type-electric{ background:#F7D02C; color:#222; }
        .type-grass   { background:#7AC74C; }
        .type-ice     { background:#96D9D6; color:#222; }
        .type-fighting{ background:#C22E28; }
        .type-poison  { background:#A33EA1; }
        .type-ground  { background:#E2BF65; color:#222; }
        .type-flying  { background:#A98FF3; }
        .type-psychic { background:#F95587; }
        .type-bug     { background:#A6B91A; }
        .type-rock    { background:#B6A136; color:#222; }
        .type-ghost   { background:#735797; }
        .type-dragon  { background:#6F35FC; }
        .type-dark    { background:#705746; }
        .type-steel   { background:#B7B7CE; color:#222; }
        .type-fairy   { background:#D685AD; color:#222; }

        /* responsive tweaks */
        @media (max-width:1000px) {
            .trainer-section { width: calc(100% - 240px); }
            .trainer-row > .pokemon-col { min-width: 160px; max-width: 160px; }
        }
        @media (max-width:860px){
            .poke-name { max-width:140px; }
        }

        @media (max-width:520px){
            .trainer-section { margin-left: 16px; width: calc(100% - 16px); }
            .trainer-row { flex-direction: column; gap: 12px; border: none; background: transparent; }
            .trainer-row > .pokemon-col { width: 100%; min-width: 0; max-width: 100%; border: var(--poke-border) solid var(--pokemon-border-color); margin-left: 0; }
            .trainer-row > div:first-child { width: 100%; min-width: 0; max-width: 100%; }
            .pokemon-inner { padding: var(--inner-padding-y) var(--inner-padding-x); }
        }
    </style>
</head>

<body>

<div class="sidebar" id="sidebar"></div>

<div class="trainer-section" id="trainerSection"></div>

<script>
    let trainerData = {};
    let groupedRoutes = {};
    let pokedexData = {}; // will hold pokedex.json entries keyed by original name
    let routeOrder = [
        "Aquacorde Town","Route 2","Santalune Forest","Route 3","Route 22","Route 22 - Part 2",
        "Santalune City","Santalune Gym","Route 4","Lumiose City","Route 5","Camphier Town",
        "Route 6","Route 6 - Pathway","Route 6 - East","Route 6 - West","Route 7",
        "Connecting Cave","Route 8","Route 8 - Upper","Route 8 - Lower","Route 8 - Sea",
        "Route 9","Glittering Cave","Ambrette Town Aqaurium","Route 10","Cyllage City",
        "Cyllage Gym","Geosenge Town","Geosenge Town - Part 2","Route 11","Reflection Cave",
        "Reflection Cave - 1F","Reflection Cave - B1F","Tower of Mastery","Shalour Gym",
        "Route 12","Azure Bay","Coumarine City","Coumarine City - Seaside",
        "Coumarine City - Cliffside","Coumarine Gym","Route 13/Power Plant",
        "Route 13/Power Plant - Route 13","Route 13/Power Plant - Kalos Power Plant",
        "Lumiose Gym","Route 14","Laverre City","Laverre Gym","Poke Ball Factory","Route 15",
        "Route 16","Lost Hotel","Dendemille Town","Frost Cavern",
        "Frost Cavern - Outside","Frost Cavern - 1F","Frost Cavern - 2F","Frost Cavern - 3F",
        "Anistar City","Anistar Gym","Lysandre Cafe/Lysandre Labs",
        "Lysandre Cafe/Lysandre Labs - Lysandre Cafe","Lysandre Labs - B1",
        "Lysandre Labs - B3","Team Flare Secret HQ - Entrance",
        "Team Flare Secret HQ - Walkway","Route 18","Terminus Cave","Terminus Cave - B1F",
        "Terminus Cave - B2F","Couriway Town","Route 19","Route 20","Snowbelle City",
        "Snowbelle Gym","Route 21","Victory Road","Victory Road - Entrance",
        "Victory Road - Inside 1","Victory Road - Outside 2","Victory Road - Inside 2",
        "Victory Road - Outside 3","Victory Road - Inside 3","Victory Road - Outside 4",
        "Victory Road - Inside 4","Elite Four/Kalos League Champion",
        "Elite Four/Kalos League Champion - Elite Four",
        "Elite Four/Kalos League Champion - Kalos League Champion","Lumiose Parade"
    ];

    const statColors = {
        "Atk": "#FF4500",
        "Def": "#FFD700",
        "SpA": "#1E90FF",
        "SpD": "#32CD32",
        "Spe": "#9400D3"
    };

    function colorNature(raw) {
        if (!raw) return raw;
        const plus = raw.match(/\+([A-Za-z]+)/);
        if (!plus) return raw;
        const stat = plus[1];
        const color = statColors[stat] || "#000";
        return `<span class="nature-colored" style="color:${color}">${raw}</span>`;
    }

    // Normalize names for fuzzy matching between trainer JSON and pokedex keys
    function normalizeName(n) {
        return (n || "").toString().toLowerCase().replace(/[^a-z0-9]/g, "");
    }

    // Find a pokedex entry by name with best-effort normalization
    function findPokedexEntry(pokeName) {
        if (!pokedexData || !pokeName) return null;
        if (pokedexData[pokeName]) return pokedexData[pokeName];
        const target = normalizeName(pokeName);
        for (const key in pokedexData) {
            if (normalizeName(key) === target) return pokedexData[key];
        }
        return null;
    }

    async function loadTrainers() {
        const sidebar = document.getElementById("sidebar");

        // Fetch both trainers and pokedex so we can pull types for trainers' pokemon
        const [trainersRes, pokedexRes] = await Promise.all([
            fetch("data/trainers.json"),
            fetch("data/pokedex.json")
        ]);
        trainerData = await trainersRes.json();
        pokedexData = await pokedexRes.json();

        for (const fullName in trainerData) {
            const base = fullName.split(" - ")[0];
            if (!groupedRoutes[base]) groupedRoutes[base] = [];
            groupedRoutes[base].push(fullName);
        }

        Object.keys(groupedRoutes).forEach(base => {
            groupedRoutes[base].sort((a, b) => routeOrder.indexOf(a) - routeOrder.indexOf(b));
        });

        routeOrder.forEach(name => {
            const base = name.split(" - ")[0];
            if (!groupedRoutes[base]) return;
            if (groupedRoutes[base][0] !== name && !name.includes(" - ")) return;
            if (sidebar.querySelector(`[data-base='${base}']`)) return;
            const tab = document.createElement("div");
            tab.className = "route-tab";
            tab.dataset.base = base;
            tab.textContent = base;
            tab.onclick = () => {
                document.querySelectorAll(".route-tab").forEach(t => t.classList.remove("active"));
                tab.classList.add("active");
                displayRoute(base);
            };
            sidebar.appendChild(tab);
        });

        if (sidebar.children.length) {
            sidebar.children[0].classList.add("active");
            displayRoute(sidebar.children[0].dataset.base);
        }
    }

    function displayRoute(baseName) {
        const container = document.getElementById("trainerSection");
        container.innerHTML = "";
        const areaTitle = document.createElement("div");
        areaTitle.className = "area-title";
        areaTitle.textContent = baseName;
        container.appendChild(areaTitle);

        groupedRoutes[baseName].forEach(subArea => {
            if (groupedRoutes[baseName].length > 1) {
                const subHeader = document.createElement("div");
                subHeader.className = "sub-header";
                subHeader.textContent = subArea;
                container.appendChild(subHeader);
            }

            const areaData = trainerData[subArea];

            areaData.Trainers.forEach(tr => {
                const card = document.createElement("div");
                card.className = "trainer-card";
                const row = document.createElement("div");
                row.className = "trainer-row";

                const trainerInfo = document.createElement("div");
                trainerInfo.innerHTML = `
                    <div class="trainer-header">${tr.TrainerClass} ${tr.TrainerName}</div>
                    <div class="trainer-sub">
                        <strong>Battle Type:</strong> ${tr.BattleType}<br>
                        <strong></strong> ${tr.Required || "N/A"}<br>
                        <strong>Reward:</strong> N/A
                    </div>
                `;
                row.appendChild(trainerInfo);

                tr.Pokemon.forEach(p => {
                    const pDiv = document.createElement("div");
                    pDiv.className = "pokemon-col";
                    const spriteName = p.Name.toLowerCase().replace(/[^a-z0-9]/g, "");

                    // ensure 4 moves, convert empty strings or whitespace to '---'
                    const moves = Array.isArray(p.Moves)
                        ? p.Moves.map(m => (typeof m === "string" && m.trim() ? m : "---"))
                        : [];
                    while (moves.length < 4) moves.push("---");

                    // Try to find types from pokedex.json
                    const dexEntry = findPokedexEntry(p.Name);
                    let typesHtml = "";
                    if (dexEntry) {
                        const t1 = dexEntry.Type1;
                        const t2 = (dexEntry.Type2 && dexEntry.Type2 !== t1) ? dexEntry.Type2 : "";
                        if (t1) {
                            typesHtml += `<span class="type-badge type-${t1.toLowerCase()}">${t1}</span>`;
                        }
                        if (t2) {
                            typesHtml += `<span class="type-badge type-${t2.toLowerCase()}">${t2}</span>`;
                        }
                    } else {
                        typesHtml = "";
                    }

                    // Wrap inner content in .pokemon-inner so separators can be drawn edge-to-edge
                    pDiv.innerHTML = `
                        <div class="pokemon-inner">
                            <div class="poke-name" style="padding: 6px 0; text-align:center; font-weight:bold;">
                                <a href="pokemon.html?name=${encodeURIComponent(p.Name)}" style="text-decoration:none; color:#000;">
                                    ${p.Name} â€” Lv ${p.Level}
                                </a>
                            </div>

                            <a href="pokemon.html?name=${encodeURIComponent(p.Name)}">
                                <img class="poke-img"
                                     src="pokemon_sprites/${spriteName}.png"
                                     onerror="this.onerror=null; this.src='pokemon_sprties2/${spriteName}.png'; this.onerror=function(){ this.src='pokemon_sprites/unknown.png'; }">
                            </a>

                            <div class="types">
                                ${typesHtml}
                            </div>

                            <!-- Removed headers; values bold & larger -->
                            <div class="info-box ability-box">
                                ${p.Ability || "---"}
                            </div>

                            <div class="info-box nature-box">
                                ${colorNature(p.Nature || "---")}
                            </div>

                            <div class="info-box item-box">
                                ${p.HeldItem || "No Item"}
                            </div>

                            <div class="info-box move-list">
                                <div class="move-header"><strong>Moves:</strong></div>
                                ${moves.map(m => `<div class="move-item">${m}</div>`).join("")}
                            </div>
                        </div>
                    `;

                    row.appendChild(pDiv);
                });

                card.appendChild(row);
                container.appendChild(card);
            });
        });
    }

    loadTrainers();
</script>

</body>
</html>
