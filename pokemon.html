<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Details</title>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body {
        font-family: "Lexend", sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 20px;
    }
    .card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        max-width: 750px;
        margin: auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    h1, h2 {
        text-align: center;
    }
    .sprite {
        display: block;
        margin: 10px auto 20px auto;
        width: 120px;
        height: 120px;
        image-rendering: pixelated;
    }
    .label {
        font-weight: bold;
        margin-top: 10px;
        margin-bottom: 4px;
        font-size: 1.1em;
        text-decoration: underline;
    }
    .type {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 12px;
        color: white;
        margin: 4px;
        font-size: 0.9em;
    }
    .type-grass { background:#63bb5b; }
    .type-poison { background:#aa5caf; }
    .type-fire { background:#ff9c54; }
    .type-water { background:#4f90d9; }
    .type-normal { background:#9099a1; }
    .type-electric { background:#f3d23b; }
    .type-ice { background:#74cec0; }
    .type-fighting { background:#ce4069; }
    .type-ground { background:#d97746; }
    .type-flying { background:#92aade; }
    .type-psychic { background:#f97176; }
    .type-bug { background:#90c12c; }
    .type-rock { background:#c7b78b; }
    .type-ghost { background:#5269ac; }
    .type-dark { background:#5a5366; }
    .type-dragon { background:#096dc4; }
    .type-steel { background:#5a8ea2; }
    .type-fairy { background:#ec8fe6; }

    ul { margin: 0; padding-left: 20px; }

    .nav-btn {
        position: absolute;
        top: 20px;
        padding: 10px 15px;
        font-size: 0.9em;
        background: #eee;
        border-radius: 8px;
        text-decoration: none;
        color: black;
        border: 1px solid #ccc;
    }
    .prev-btn { left: 20px; }
    .next-btn { right: 20px; }

    .section {
        margin-top: 30px;
    }
</style>
</head>
<body>

<a id="prevBtn" class="nav-btn prev-btn">← Prev</a>
<a id="nextBtn" class="nav-btn next-btn">Next →</a>

<div id="pokemonCard" class="card">Loading…</div>

<script>
async function loadPokemon() {
    const urlParams = new URLSearchParams(window.location.search);
    const name = urlParams.get("name");

    const pokedex = await fetch("data/pokedex.json").then(r => r.json());
    const movesets = await fetch("data/movesets.json").then(r => r.json());

    const mon = pokedex[name];
    const moves = movesets[name] || [];

    if (!mon) {
        document.getElementById("pokemonCard").innerHTML = "<h2>Pokémon not found.</h2>";
        return;
    }

    // NAVIGATION LOGIC
    const entries = Object.entries(pokedex).sort((a,b) => a[1].SpeciesIdx - b[1].SpeciesIdx);
    const names = entries.map(e => e[0]);
    const idx = names.indexOf(name);

    const prevName = names[(idx - 1 + names.length) % names.length];
    const nextName = names[(idx + 1) % names.length];

    const prevData = pokedex[prevName];
    const nextData = pokedex[nextName];

    document.getElementById("prevBtn").href = `pokemon.html?name=${encodeURIComponent(prevName)}`;
    document.getElementById("nextBtn").href = `pokemon.html?name=${encodeURIComponent(nextName)}`;

    document.getElementById("prevBtn").textContent = `← #${String(prevData.SpeciesIdx).padStart(3,"0")} ${prevName}`;
    document.getElementById("nextBtn").textContent = `#${String(nextData.SpeciesIdx).padStart(3,"0")} ${nextName} →`;

    // BST
    const bst = mon.BST ??
        (mon.BaseStats.HP + mon.BaseStats.Atk + mon.BaseStats.Def +
         mon.BaseStats.SpA + mon.BaseStats.SpD + mon.BaseStats.Spe);

    // EVOLUTIONS (placeholder - you will add later)
    const evolutionsHTML = `<p>No evolution data yet.</p>`;

    // BUILD PAGE
    document.getElementById("pokemonCard").innerHTML = `
        <h1>#${String(mon.SpeciesIdx).padStart(3,"0")} ${name}</h1>

        <img class="sprite" src="https://play.pokemonshowdown.com/sprites/gen5/${name.toLowerCase()}.png">

        <!-- INFO SECTION -->
        <div class="section">
            <h2>Info</h2>

            <p class="label">Types</p>
            <div>
                <span class="type type-${mon.Type1.toLowerCase()}">${mon.Type1}</span>
                ${mon.Type2 && mon.Type2 !== mon.Type1 ? 
                    `<span class="type type-${mon.Type2.toLowerCase()}">${mon.Type2}</span>` : ""}
            </div>

            <p class="label">Abilities</p>
            <ul>
                <li>${mon.Ability1}</li>
                ${mon.Ability2 ? `<li>${mon.Ability2}</li>` : ""}
                <li><em>Hidden:</em> ${mon.AbilityH}</li>
            </ul>

            <p class="label">Additional Info</p>
            <p>No additional data available.</p>
        </div>

        <!-- BASE STATS -->
        <div class="section">
            <h2>Base Stats</h2>
            <ul>
                <li>HP: ${mon.BaseStats.HP}</li>
                <li>Atk: ${mon.BaseStats.Atk}</li>
                <li>Def: ${mon.BaseStats.Def}</li>
                <li>SpA: ${mon.BaseStats.SpA}</li>
                <li>SpD: ${mon.BaseStats.SpD}</li>
                <li>Spe: ${mon.BaseStats.Spe}</li>
                <li><strong>BST: ${bst}</strong></li>
            </ul>
        </div>

        <!-- EVOLUTIONS -->
        <div class="section">
            <h2>Evolutions</h2>
            ${evolutionsHTML}
        </div>

        <!-- MOVES -->
        <div class="section">
            <h2>Moves</h2>
            <div style="display:flex; gap:20px; flex-wrap:wrap;">
                
                <div style="flex:1; min-width:200px;">
                    <p class="label">Level-up Moves</p>
                    <ul>
                        ${moves.map(m => `<li>Lvl ${m.Level}: ${m.Move}</li>`).join("")}
                    </ul>
                </div>

                <div style="flex:1; min-width:200px;">
                    <p class="label">TMs</p>
                    <ul>
                        ${mon.TMs.map(tm => `<li>${tm.Label}: ${tm.Move}</li>`).join("")}
                    </ul>
                </div>
            </div>
        </div>
    `;
}

loadPokemon();
</script>

</body>
</html>
