
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Stats</title>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  body { font-family:"Lexend", sans-serif; background:#f0f0f0; margin:0; padding:20px; }
  a.back { color:#4285F4; text-decoration:none; display:inline-block; margin-bottom:20px; }
  h1 { text-align:center; margin-bottom:10px; }
  .card { background:white; padding:20px; border-radius:15px; box-shadow:0 3px 8px rgba(0,0,0,0.15); max-width:900px; margin:auto; position:relative; }

  /* Section Styling */
  .section { margin-bottom:25px; background:#fafafa; padding:15px 20px; border-radius:12px; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
  .section h2 { margin-top:0; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px; }

  .sprite { display:block; margin:10px auto; width:128px; height:128px; image-rendering:pixelated; }
  .types { text-align:center; margin-bottom:10px; }
  .type { display:inline-block; padding:4px 10px; border-radius:12px; font-size:0.85em; color:white; margin:3px; }

  .nav-btn { position:absolute; top:20px; padding:6px 12px; background:#4285F4; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; }
  .prev-btn { left:20px; }
  .next-btn { right:20px; }
  .nav-btn:hover { background:#3367d6; }

  ul { list-style:none; padding-left:0; margin:0 0 10px 0; }
  .label { font-weight:bold; margin-top:10px; margin-bottom:3px; }
  .moves-list li { margin-bottom:4px; }

  /* Type Colors */
  .type-grass { background: #63bb5b; }
  .type-poison { background: #aa5caf; }
  .type-fire { background: #ff9c54; }
  .type-water { background: #4f90d9; }
  .type-normal { background: #9099a1; }
  .type-electric { background: #f3d23b; }
  .type-ice { background: #74cec0; }
  .type-fighting { background: #ce4069; }
  .type-ground { background: #d97746; }
  .type-flying { background: #92aade; }
  .type-psychic { background: #f97176; }
  .type-bug { background: #90c12c; }
  .type-rock { background: #c7b78b; }
  .type-ghost { background: #5269ac; }
  .type-dark { background: #5a5366; }
  .type-dragon { background: #096dc4; }
  .type-steel { background: #5a8ea2; }
  .type-fairy { background: #ec8fe6; }

  /* Evolution Styles */
  #evolution-chain { display:flex; align-items:center; justify-content:center; gap:40px; flex-wrap:nowrap; margin-top:10px; }
  .evo-block { text-align:center; }
  .evo-img { width:120px; height:120px; image-rendering:pixelated; display:block; margin:0 auto 5px; }
  .evo-name { font-weight:bold; font-size:18px; }
  .evo-arrow-block { text-align:center; }
  .method-text { font-size:14px; font-weight:600; text-decoration:underline; margin-bottom:5px; }
  .arrow { font-size:30px; font-weight:bold; }
</style>
</head>
<body>

<a class="back" href="index.html">← Back to Pokédex</a>
<div id="pokemonCard" class="card">Loading…</div>

<script>
const typeColors = {
  Normal:"#9099a1", Fire:"#ff9c54", Water:"#4f90d9", Electric:"#f3d23b", Grass:"#63bb5b",
  Ice:"#74cec0", Fighting:"#ce4069", Poison:"#aa5caf", Ground:"#d97746", Flying:"#92aade",
  Psychic:"#f97176", Bug:"#90c12c", Rock:"#c7b78b", Ghost:"#5269ac", Dragon:"#096dc4",
  Dark:"#5a5366", Steel:"#5a8ea2", Fairy:"#ec8fe6"
};

const monName = new URL(window.location.href).searchParams.get("name");

Promise.all([
  fetch('data/pokedex.json').then(r => r.json()),
  fetch('data/movesets.json').then(r => r.json()),
  fetch('data/evolutions.json').then(r => r.json())
])
.then(([pokedexData, movesetsData, evolutionsData]) => {
  const mon = pokedexData[monName];
  if (!mon) { document.getElementById("pokemonCard").textContent = "Pokémon not found."; return; }

  const sortedMonNames = Object.entries(pokedexData).sort((a,b)=>a[1].SpeciesIdx-b[1].SpeciesIdx).map(([name])=>name);
  const currentIndex = sortedMonNames.indexOf(monName);
  const prevMon = sortedMonNames[(currentIndex-1+sortedMonNames.length)%sortedMonNames.length];
  const nextMon = sortedMonNames[(currentIndex+1)%sortedMonNames.length];
  const prevMonData = pokedexData[prevMon];
  const nextMonData = pokedexData[nextMon];

  const types = [mon.Type1, mon.Type2].filter((t,i,a)=>t && a.indexOf(t)===i);
  const spriteName = monName.toLowerCase().replace(/\s+/g,'-');
  const imageUrl = `https://play.pokemonshowdown.com/sprites/gen5/${spriteName}.png`;
  const bst = mon.BST ?? (mon.BaseStats.HP+mon.BaseStats.Atk+mon.BaseStats.Def+mon.BaseStats.SpA+mon.BaseStats.SpD+mon.BaseStats.Spe);
  const moves = movesetsData[monName] || [];

  const cardDiv = document.getElementById("pokemonCard");
  cardDiv.innerHTML = `
    <button class="nav-btn prev-btn" onclick="location.href='pokemon.html?name=${encodeURIComponent(prevMon)}'">
      ← #${String(prevMonData.SpeciesIdx).padStart(3,"0")} ${prevMon}
    </button>
    <button class="nav-btn next-btn" onclick="location.href='pokemon.html?name=${encodeURIComponent(nextMon)}'">
      #${String(nextMonData.SpeciesIdx).padStart(3,"0")} ${nextMon} →
    </button>

    <h1>#${String(mon.SpeciesIdx).padStart(3,"0")} ${monName}</h1>
    <img class="sprite" src="${imageUrl}" onerror="this.src='https://play.pokemonshowdown.com/sprites/gen5/unknown.png'">

   <!-- Info Section (Horizontal subheadings with centered Type) -->
<div class="section info">
  <h2>Info</h2>
  <div style="display:flex; justify-content:space-between; gap:20px; flex-wrap:wrap;">
    <!-- Type -->
    <div style="flex:1; min-width:200px; text-align:center;">
      <h3 style="text-decoration:underline;">Type</h3>
      <div class="types">
        ${types.map(t=>`<span class="type" style="background:${typeColors[t]}">${t}</span>`).join("")}
      </div>
    </div>

    <!-- Abilities -->
    <div style="flex:1; min-width:200px;">
      <h3 style="text-decoration:underline;">Abilities</h3>
      <ul>
        <li>1. ${mon.Ability1}</li>
        <li>${mon.Ability2 ? `2. ${mon.Ability2}` : ""}</li>
        <li><em>Hidden:</em> ${mon.AbilityH}</li>
      </ul>
    </div>

    <!-- Additional Info -->
    <div style="flex:1; min-width:200px;">
      <h3 style="text-decoration:underline;">Additional Info</h3>
      <p>Data will come from the additional info JSON.</p>
    </div>
  </div>
</div>

    <!-- Base Stats Section -->
    <div class="section stats">
      <h2>Base Stats</h2>
      <ul>
        <li>HP: ${mon.BaseStats.HP}</li>
        <li>Atk: ${mon.BaseStats.Atk}</li>
        <li>Def: ${mon.BaseStats.Def}</li>
        <li>SpA: ${mon.BaseStats.SpA}</li>
        <li>SpD: ${mon.BaseStats.SpD}</li>
        <li>Spe: ${mon.BaseStats.Spe}</li>
        <li><strong>BST: ${bst}</strong></li>
      </ul>
    </div>

  <!-- Evolutions Section -->
<div class="section evolutions">
  <h2>Evolutions</h2>
  <div id="evolution-chain"></div>
</div>

    <!-- Moves Section -->
    <div class="section moves">
      <h2>Moves</h2>
      <div style="display:flex; gap:20px; flex-wrap:wrap; margin-top:10px;">
        ${moves.length ? `
          <div style="flex:1; min-width:200px;">
            <p class="label">Level-up Moves</p>
            <ul class="moves-list">
              ${moves.map(m=>`<li>Lvl ${m.Level}: ${m.Move}</li>`).join("")}
            </ul>
          </div>
        ` : ""}
        ${mon.TMs ? `
          <div style="flex:1; min-width:200px;">
            <p class="label">TMs</p>
            <ul>
              ${mon.TMs.map(tm=>`<li>${tm.Label}: ${tm.Move}</li>`).join("")}
            </ul>
          </div>
        ` : ""}
      </div>
    </div>
  `;

  // Load evolution chain (kept exact same formatting as original)
  loadEvolutions(monName, evolutionsData);
});

function loadEvolutions(currentName, data) {
    const evoContainer = document.getElementById("evolution-chain");
    evoContainer.innerHTML = "<p>Loading...</p>";

    if (!data[currentName]) {
        evoContainer.innerHTML = "<p>No evolution data available.</p>";
        return;
    }

    // Find earliest stage
    let pointer = currentName;
    while (data[pointer] && data[pointer].EvolvesFrom) pointer = data[pointer].EvolvesFrom;

    const rendered = new Set(); // Track which Pokémon are already rendered

    const renderEvo = (name) => {
        if (rendered.has(name)) return ""; // Skip duplicates
        rendered.add(name);
        const imgSrc = `https://play.pokemonshowdown.com/sprites/gen5/${name.toLowerCase()}.png`;
        return `
            <div class="evo-block">
                <img src="${imgSrc}" class="evo-img">
                <div class="evo-name">${name}</div>
            </div>
        `;
    };

    const traverseChain = (name) => {
        const evolvesInto = data[name].EvolvesInto || {};
        const keys = Object.keys(evolvesInto);

        // Render current Pokémon if not already rendered
        if (!rendered.has(name)) {
            evoContainer.innerHTML += renderEvo(name);
        }

        keys.forEach((nextName, i) => {
            const method = evolvesInto[nextName];
            // Render arrow + method only if next Pokémon isn't already rendered
            if (!rendered.has(nextName)) {
                evoContainer.innerHTML += `
                    <div class="evo-arrow-block">
                        <div class="method-text">${method}</div>
                        <div class="arrow">→</div>
                    </div>
                `;
                evoContainer.innerHTML += renderEvo(nextName);
            }

            // Recursively render evolutions of the next Pokémon
            if (data[nextName] && Object.keys(data[nextName].EvolvesInto || {}).length > 0) {
                traverseChain(nextName);
            }
        });
    };

    traverseChain(pointer);
}

</script>

</body>
</html>
